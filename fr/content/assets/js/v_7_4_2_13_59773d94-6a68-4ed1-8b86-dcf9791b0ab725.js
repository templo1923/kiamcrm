import{E as m,ao as T,b as o,n as k,c as S,ap as C}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab723.js";import{u as l}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab736.js";import{r as u,aw as p,g as f,R as v,G as w,C as R}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab710.js";import{b as M}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab719.js";import{W as D}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab718.js";const y=(e,s)=>{const a=new Set(e.map(t=>t.id));return s.filter(t=>!a.has(t.id))},I=(e,s)=>{e=e||[],s=s||[];const a=y(e,s),t=[];for(let r of a)t.push({id:r.id,type:r.type,categoria:r.categoria,titulo:r.titulo,script:r.script});return[...e,...t]},N=(e,s,a,t)=>{e=e||[],s=s||[],a=a||[],t=t||[];const r=y(a,t),n=[],d=i=>{var h;const c=[],b=((h=s.find(U=>U.id===i.id))==null?void 0:h.base64)||"";switch(i.type){case"txt":c.push({id:u(),type:i.type,propriedades:{mensagem:i.mensagem,composing:1,aguarde:0}});break;case"image":case"video":c.push({id:u(),type:i.type,propriedades:{base64:b,mensagem:i.mensagem,composing:1,aguarde:0,isViewOnce:!1,microVideo:!1}});break;case"audio":c.push({id:u(),type:i.type,propriedades:{base64:b,composing:1}});break;case"doc":c.push({id:u(),type:i.type,propriedades:{base64:b,base64Name:i.base64Name}});break;case"contact":c.push({id:u(),type:i.type,propriedades:{userID:i.phone,userName:i.name}});break}return i.config.removeAbas&&c.push({id:u(),type:"removeAllCRM",propriedades:{}}),i.config.removeEtiquetas&&c.push({id:u(),type:"removeAllLabel",propriedades:{}}),i.config.aba.length!==0&&c.push({id:u(),type:"addCRM",propriedades:{crmID:"abas",abaID:i.config.aba}}),i.config.etiqueta.length!==0&&c.push({id:u(),type:"addLabel",propriedades:{labelID:i.config.etiqueta}}),i.config.arquivar&&c.push({id:u(),type:"arquivar",propriedades:{}}),c};for(let i of r)i.type!=="script"&&n.push({id:i.id,acao:d(i)});return[...e,...n]};function H(){chrome.storage.local.get(["respostasRapidas","categoria","respostasRapidasAcao","guardaMsg","medias"],({respostasRapidas:e,categoria:s,respostasRapidasAcao:a,guardaMsg:t,medias:r})=>{m.setState({actions:N(a,r,e,t)}),l.setState({categories:s}),T.setState({quickReplies:I(e,t)})})}function L(e,s,a){e=e||[],s=s||[],a=a||[],m.setState({actions:e}),T.setState({quickReplies:s}),l.setState({categories:a}),chrome.storage.local.set({respostasRapidasAcao:e,respostasRapidas:s,categoria:a}),chrome.runtime.sendMessage({action:"initRespostaRapidas"})}function J(e,s,a){const{actions:t}=m.getState(),{quickReplies:r}=T.getState(),{categories:n}=l.getState();e=e||[],s=s||[],a=a||[];const d=p([...t,...e]),i=p([...r,...s]),c=p([...n,...a]);L(d,i,c)}const A=async(e,s)=>{const{name:a}=await D.Utils("getContato",e),t=o.getState().userTabs.map(r=>s.length===36&&r.id===s||r.tag===s?!k.getState().user.estado&&r.chats.length>=5?(window.postMessage({action:"modal-userFree",plugin_page:M.getState().plugin_page},"*"),r):{...r,chats:[...r.chats,{id:e,name:a}]}:r);o.setState({userTabs:t})},E=(e,s)=>{const a=o.getState().userTabs;a.map(t=>(t.id===s&&(t.chats=[...t.chats,...e.filter(r=>!t.chats.some(n=>n.id===r.id))]),t)),o.setState({userTabs:a})},F=(e,s,a)=>{const t=o.getState().userTabs.map(r=>(r.id===s&&(r.chats=r.chats.filter(n=>!e.some(d=>d.id===n.id))),r.id===a&&(r.chats=[...r.chats,...e.filter(n=>!r.chats.some(d=>d.id===n.id))]),r));o.setState({userTabs:t})},O=(e,s,a)=>{let t=o.getState().userTabs;s?t=t.map(r=>({...r,chats:r.chats.filter(n=>n.id!==e)})):t=t.map(r=>a.length===36&&r.id===a||r.tag===a?{...r,chats:r.chats.filter(n=>n.id!==e)}:r),o.setState({userTabs:t})},P=e=>{const s=[e,...o.getState().userTabs];o.setState({userTabs:s})},V=e=>{const s=o.getState().userTabs.map(a=>(a.id===e&&(a.hide=!a.hide),a));o.setState({userTabs:s})},x=(e,s)=>{const a=o.getState().userTabs.map(t=>t.id===e?{...t,tag:s}:t);o.setState({userTabs:a})},B=e=>{const s=o.getState().userTabs.filter(a=>a.id!==e);o.setState({userTabs:s})},Q=(e,s)=>{const a=Array.from(o.getState().userTabs),[t]=a.splice(e,1);a.splice(s,0,t),o.setState({userTabs:a})};chrome.runtime.onMessage.addListener(async e=>{switch(e.action){case"userTabs-setNewUser":A(e.dados.userID,e.dados.id);break;case"userTabs-setChatsTab":o.getState().setChatsTab(e.dados.chats,e.dados.id,!1);break;case"userTabs-setCopyChats":E(e.dados.chats,e.dados.id);break;case"userTabs-setMoveChats":F(e.dados.chats,e.dados.source,e.dados.destination);break;case"userTabs-setRemoveUser":O(e.dados.userID,e.dados.isAll,e.dados.id);break;case"userTabs-setCreateUserTab":P(e.dados.newUserTab);break;case"userTabs-setVisibilityUserTab":V(e.dados.id);break;case"userTabs-setEditUserTabName":x(e.dados.id,e.dados.tabName);break;case"userTabs-setRemoveTab":B(e.dados.id);break;case"userTabs-sortUserTabs":Q(e.dados.home,e.dados.destination);break}});chrome.runtime.onMessage.addListener(e=>{e.action==="initUserTabs"&&W()});const g=e=>{let s=!1;const a=e.map(t=>t.id?t:(s=!0,{...t,id:t.tag}));return{isOldFormat:s,refatoredUserTabs:a}},W=async()=>{S.setState({initSubscribeUserTabs:!1});const e=await v("userTabs"),{refatoredUserTabs:s,isOldFormat:a}=g(e);a&&f("userTabs",s);let t=C;const r=await w("SystemTabsDB","SystemTabs");r[0]&&r[0][0]&&(t=R.decryptData(r[0][0])),o.setState({userTabs:s,systemTabs:t}),S.setState({initSubscribeUserTabs:!0})};async function K(e){const{refatoredUserTabs:s}=g(e);o.setState({userTabs:s}),await f("userTabs",s),chrome.runtime.sendMessage({action:"initUserTabs"})}async function X(e){const{refatoredUserTabs:s}=g(e),a=o.getState().userTabs,t=new Set,r=a.filter(i=>t.has(i.id)?!1:(t.add(i.id),!0)),n=s.filter(i=>!t.has(i.id)),d=r.concat(n);o.setState({userTabs:d}),await f("userTabs",d),chrome.runtime.sendMessage({action:"initUserTabs"})}export{X as M,K as R,W as a,N as b,J as c,L as d,I as f,H as i};
