import{b as K,u as g}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab719.js";import{aj as E,q as S,o as A,n as v}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab723.js";import{j as c,ax as I,y as O,ay as T,an as L,ab as M,ae as R,T as D,az as U,aA as P,ad as $,ac as z,aa as _,U as h,I as p,C as j,N as W,g as y,R as F}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab710.js";import{S as q}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab737.js";import{b as J,a as Y}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab738.js";import{C as G}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab739.js";import{b as H}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab740.js";import{b as Q}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab741.js";import{c as V,P as X}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab78.js";import{W as b}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab718.js";import{c as N}from"./v_7_4_2_13_59773d94-6a68-4ed1-8b86-dcf9791b0ab77.js";const f=[{keys:[{key:"",compress:!1}],tag:"all",nome:"selectAllBackup",checked:!1,merge:!1,icon:c.jsx(I,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"respostasRapidas",compress:!0},{key:"respostasRapidasAcao",compress:!1},{key:"categoria",compress:!0},{key:"guardaMsg",compress:!0},{key:"medias",compress:!1}],tag:"respostasRapidas",nome:"quickReply",checked:!1,merge:!1,icon:c.jsx(O,{className:"w-6 h-6 fill-[var(--primaria)]"})},{keys:[{key:"agendamentos",compress:!1},{key:"agendamentosNaoDisparados",compress:!1},{key:"sendAfterWhatsAppOpens",compress:!0}],tag:"agendamentos",nome:"appointments",checked:!1,merge:!1,icon:c.jsx(T,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"crm",compress:!0}],tag:"crm",nome:"CRM",checked:!1,merge:!1,icon:c.jsx(G,{size:"24px",color:"var(--primaria)"})},{keys:[{key:"contatos",compress:!0}],tag:"contatos",nome:"contacts",checked:!1,merge:!1,icon:c.jsx(J,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"notes",compress:!0}],tag:"notes",nome:"notes",checked:!1,merge:!1,icon:c.jsx(V,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"notifications",compress:!0}],tag:"notifications",nome:"notifications",checked:!1,merge:!1,icon:c.jsx(q,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"perfil",compress:!0}],tag:"perfil",nome:"profile",checked:!1,merge:!1,icon:c.jsx(E,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"userTabs",compress:!0}],tag:"userTabs",nome:"userTabs",checked:!1,merge:!1,icon:c.jsx(L,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"agrupamentos",compress:!0},{key:"relatorio",compress:!0}],tag:"envioEmMassa",nome:"bulkSending",checked:!1,merge:!1,icon:c.jsx(Y,{className:"w-6 h-6 fill-[var(--primaria)]"})},{keys:[{key:"encomendas",compress:!0}],tag:"encomendas",nome:"encomendas",checked:!1,merge:!1,icon:c.jsx(X,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"autoatendimento",compress:!1}],tag:"autoatendimento",nome:"autoAtendimento",checked:!1,merge:!1,icon:c.jsx(M,{className:"text-[var(--primaria)]",size:24})},{keys:[{key:"webhook",compress:!0}],tag:"webhook",nome:"webhook",checked:!1,merge:!1,disabledMerge:!0,icon:c.jsx(R,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"IA",compress:!0}],tag:"IA",nome:"IA",checked:!1,merge:!1,disabledMerge:!0,icon:c.jsx(H,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"status",compress:!1}],tag:"status",nome:"status",checked:!1,merge:!1,icon:c.jsx(Q,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"pinChat",compress:!0}],tag:"pinChat",nome:"fixContacts",checked:!1,merge:!1,icon:c.jsx(D,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"atendimento",compress:!0}],tag:"atendimento",nome:"finalizedOrTrasferAtt",checked:!1,merge:!1,disabledMerge:!0,icon:c.jsx(U,{strokeWidth:.4,className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"backupAutomatico",compress:!0}],tag:"backupAutomatico",nome:"automaticBk",checked:!1,merge:!1,disabledMerge:!0,icon:c.jsx(P,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"whatsApi",compress:!0}],tag:"whatsApi",nome:"whatsApi",checked:!1,merge:!1,disabledMerge:!0,icon:c.jsx($,{strokeWidth:.4,className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"FollowUp",compress:!1}],tag:"FollowUp",nome:"followUp",checked:!1,merge:!1,icon:c.jsx(z,{className:"text-[var(--primaria)]",size:24})},{keys:[{key:"fluxo",compress:!0},{key:"fluxoFiles",compress:!1}],tag:"fluxo",nome:"fluxo",checked:!1,merge:!1,icon:c.jsx(_,{className:"text-[var(--primaria)]",size:24})}],Z=N()((i,d)=>({backup:null,keys:[],getBackup:()=>chrome.storage.local.get(null,async e=>{const{language:a}=g.getState();try{const r=f.filter(t=>!!(t.tag==="all"||t.tag==="IA"&&e.IA&&e.IA.activeIA||t.tag==="atendimento"&&e.atendimento||t.tag==="backupAutomatico"&&e.backupAutomatico&&e.backupAutomatico.date.length>0||t.tag==="whatsApi"&&e.whatsApi&&e.whatsApi.token.length>0||t.tag==="fluxo"&&e.fluxo&&e.fluxo.workflows.length>0||t.keys.find(s=>e[s.key]&&e[s.key].length>0)));i({keys:r,backup:e})}catch(r){console.error("Erro ao tentar capturar o backup",r),p({type:"Error",message:a.getBkError,position:"top-right"})}}),setActiveKey:(e,a)=>i(r=>({keys:r.keys.map(s=>e==="all"?{...s,checked:a}:s.tag===e?{...s,checked:a}:s.tag==="all"&&!a?{...s,checked:!1}:s)})),setActiveMerge:(e,a)=>i(r=>({keys:r.keys.map(s=>e==="all"?{...s,merge:a}:s.tag===e?{...s,merge:a}:s.tag==="all"&&!a?{...s,merge:!1}:s)})),clearState:()=>i({backup:null,keys:[]}),exportBackup:()=>{const{backup:e,keys:a,downloadBackup:r}=d(),{language:t}=g.getState(),{close:s,openRendertype:o}=A.getState(),{user:m}=v.getState();if(!a.find(u=>u.checked)){p({type:"Error",message:t.selectBkItemExport,position:"top-right"});return}if(!m.estado){o("user_free");return}const n={};for(let u of a)if(!(!u.checked||u.tag==="all"))for(let l of u.keys)l.compress?n[l.key]=j.encryptData(e[l.key]):n[l.key]=e[l.key];delete n.guardaMsg,delete n.medias,s(),r(n)},downloadBackup:e=>{const{whatsappID:a}=K.getState(),{label:r}=S.getState(),{language:t}=g.getState(),s=JSON.stringify(e),o=new Blob([s],{type:"application/json"}),{day:m,month:n,year:u}=h.dayDate(),{hours:l,minutes:x,seconds:C}=h.timeDate(),w=`backup_${m}-${n}-${u}_${l} ：${x} ：${C}.json`,k=document.createElement("a");k.setAttribute("href",URL.createObjectURL(o)),k.setAttribute("download",w),k.style.display="none",document.body.appendChild(k),k.click(),document.body.removeChild(k),p({type:"Success",message:t.backup_exportado,position:"top-right"}),(async()=>(await b.Chat("sendTxt",{id:a,msg:`*_${r.name}:_*
 ${t.bkMessageSucess}`}),b.Chat("sendDoc",{id:a,base64:o,name:w})))()}})),B=N()((i,d)=>({automaticoBK:{date:"",time:"",recurrency:"",items:[]},createOrEditAttBk:{date:"",time:"",recurrency:"",items:[]},keys:f,startCreateOrEditAtt:()=>i(e=>{const a=f.map(r=>e.automaticoBK.items.length+1===f.reduce((t,s)=>t+s.keys.length,0)?{...r,checked:!0}:r.keys.find(t=>e.automaticoBK.items.includes(t.key))?{...r,checked:!0}:r);return{createOrEditAttBk:e.automaticoBK,keys:a}}),setCreateOrEditAttBk:e=>i(()=>({createOrEditAttBk:e})),setActiveKey:(e,a)=>i(r=>{const t=r.keys.map(o=>e==="all"?{...o,checked:a}:o.tag===e?{...o,checked:a}:o.tag==="all"&&!a?{...o,checked:!1}:o),s=t.reduce((o,m)=>(m.checked&&m.tag!=="all"&&o.push(...m.keys.map(n=>n.key)),o),[]);return{keys:t,createOrEditAttBk:{...r.createOrEditAttBk,items:s}}}),saveAutomaticoBK:()=>{const{createOrEditAttBk:e,keys:a}=d(),{language:r}=g.getState(),{close:t}=A.getState();if(!a.find(s=>s.checked)){p({type:"Error",message:r.bkAttNotItem,position:"top-right"});return}if(e.date.length<=0||e.time.length<=0){p({type:"Error",message:r.bkAttNotDateOrTime,position:"top-right"});return}y("backupAutomatico",e),i({automaticoBK:e,keys:f}),t(),p({type:"Success",message:r.autoBackupCreated,position:"top-right"})},removeAutomaticoBK:()=>i(()=>{const{close:e}=A.getState(),{language:a}=g.getState();return y("backupAutomatico",{date:"",time:"",recurrency:"",items:[]}),e(),p({type:"Success",message:a.autoBackupRemoved,position:"top-right"}),{automaticoBK:{date:"",time:"",recurrency:"",items:[]}}}),validateTimeoutBk:()=>{const{automaticoBK:e,exportBkAtt:a}=d();if(e.date.length<=0)return;if(h.Dois_min_differ(`${e.date} ${e.time}`)){a();let t=e;e.recurrency===""?t={...e,date:"",time:""}:t={...e,date:h.CalcularProximaData(e.date,e.recurrency)},i({automaticoBK:t}),y("backupAutomatico",t)}},exportBkAtt:()=>{const{automaticoBK:e}=d(),{downloadBackup:a}=Z.getState(),{user:r}=v.getState(),{language:t}=g.getState(),{label:s}=S.getState();if(!r.estado){W("backupAutomatico",t.btnPremium,s.checkout);return}chrome.storage.local.get([...e.items],o=>{const m={};for(const n of e.items)if(!(n==="IA"&&(!o.IA||!o.IA.activeIA))&&!(n==="atendimento"&&o.atendimento)&&!(!o[n]||o[n].length===0))for(const u of f){const l=u.keys.find(x=>x.key===n);l&&(l.compress?m[n]=j.encryptData(o[n]):m[n]=o[n])}a(m)})}}));(async()=>{const i=await F("backupAutomatico");i&&i.date.length>0&&B.setState({automaticoBK:i})})();const ue=i=>{B.setState({automaticoBK:i}),y("backupAutomatico",i)};chrome.runtime.onMessage.addListener(async i=>{switch(i.action){case"Update_BackupAutomatico":B.getState().validateTimeoutBk();break}});export{f as B,Z as a,ue as b,B as u};
